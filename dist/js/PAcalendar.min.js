!function($){$.fn.PACalendar=function(e){function t(){i=$("<header></header>").addClass("PAheader"),c=$("<span></span>").html(m.prevArrow).addClass("PAHprev"),A=$("<span></span>").html(m.nextArrow).addClass("PAHnext"),P=$("<span></span>").addClass("PAHmonth"),v=$("<section></section>").addClass("PAweek");for(var e=1;8>e;e++)v.append($("<span></span>").text(moment().day(e).format("dd")));p=$("<section></section>").addClass("PAmonth"),i.append(c).append(P).append(A),n.addClass("PACalendar").append(i).append(v).append(p),m.from.element.addClass("PAcalendar_element").attr("rel",r),m.to.element.addClass("PAcalendar_element").attr("rel",r)}function a(e){var t=moment(e),a=t.month(),n=t.year();P.text(t.format("MMMM YYYY")).attr("data-month",a).attr("data-year",n),t.set("date",1),t.subtract((t.day()||8)-1,"days"),p.find("span").remove();for(var r=0;42>r;r++){var s=t.date(),l=t.month(),i=moment(t),c=$("<span></span>").text(s).attr("data-value",i.format("YYYYMMDD")).toggleClass("PAactive",l===a);"range"===m.mode&&(c.toggleClass("PAfrom",d.isSame(i)),f&&f.isValid()&&c.toggleClass("PAto",f.isSame(i))),p.append(c),t.add(1,"days")}o()}function o(){p.find("span").removeClass("PAselected PAfrom PAto PAbetween"),"range"===m.mode&&f&&f.isValid()&&d.isValid()&&d.isBefore(f)&&p.find("span[data-value]").each(function(e,t){var a=moment($(t).attr("data-value"),"YYYYMMDD");$(t).toggleClass("PAbetween",a.isAfter(d)&&a.isBefore(f))}),p.find('span[data-value="'+d.format("YYYYMMDD")+'"]').removeClass("PAbetween").addClass("PAselected PAfrom"),"range"===m.mode&&f&&f.isValid()&&p.find('span[data-value="'+f.format("YYYYMMDD")+'"]').removeClass("PAbetween").addClass("PAselected PAto")}var n=this,m=$.extend(!0,{prevArrow:"&laquo;",nextArrow:"&raquo;",from:{date:moment(),element:$('[data-element="from"]')},to:{date:null,element:$('[data-element="to"]')},mode:"date",locale:moment.locale(),format:"YYYY-MM-DD"},e);moment.locale(m.locale);var r=Math.random().toString(36).substring(7);m.from.element&&(m.from.date=moment(m.from.element.val(),m.format),m.from.date.isValid()||(m.from.date=moment()),m.from.element.val(moment(m.from.date).format(m.format))),m.to.element&&(m.to.date=moment(m.to.element.val(),m.format),m.to.date.isValid()||(m.to.date=moment()),m.to.element.val(moment(m.to.date).format(m.format)),m.to.date.isBefore(m.from.date)&&(m.to.element.val(""),m.to.date=null));var s=!0,l=moment(m.from.date),d=moment(m.from.date),f="range"===m.mode?moment(m.to.date):null;m.from.element.addClass("PAactive");var i,c,A,P,v,p;return t(),a(l),p.addClass(s?"PAfrom":"PAto"),A.off("click").on("click",function(){l.add(1,"months"),a(l)}),c.off("click").on("click",function(){l.subtract(1,"months"),a(l)}),p.off("click","span.PAactive").on("click","span.PAactive",function(){var e=s?"PAto":"PAfrom";p.find("span:not(."+e+")").removeClass("PAselected"),$(this).addClass("PAselected");var t=moment($(this).attr("data-value"),"YYYYMMDD");s&&(d=t,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format))),"range"===m.mode&&(s||(f=t,m.to.element&&m.to.element.val(moment(t,"YYYYMMDD").format(m.format))),p.find("span").removeClass(s?"PAfrom":"PAto"),$(this).addClass(s?"PAfrom":"PAto"),d>f?(p.find("span").removeClass("PAselected PAbetween PAfrom PAto"),$(this).addClass("PAselected PAfrom"),d=t,f=null,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format)),m.to.element&&m.to.element.val(""),s=!1):s=!s),"range"===m.mode&&d&&f&&n.trigger({type:"setDate",from:moment(d),to:moment(f)}),"range"!==m.mode&&d&&n.trigger({type:"setDate",from:moment(d)}),$('.PAcalendar_element[rel="'+r+'"]').removeClass("PAactive"),m[s?"from":"to"].element.addClass("PAactive"),o()}),m.from.element&&m.from.element.off("change keyup").on("change keyup",function(){n.setDateFrom($(this).val())}).off("focus").on("focus",function(){s=!0,$('.PAcalendar_element[rel="'+r+'"]').removeClass("PAactive"),m.from.element.addClass("PAactive")}),m.to.element&&m.to.element.off("change keyup").on("change keyup",function(){n.setDateTo($(this).val())}).off("focus").on("focus",function(){s=!1,$('.PAcalendar_element[rel="'+r+'"]').removeClass("PAactive"),m.to.element.addClass("PAactive")}),n.setMode=function(e){return"range"===e||"date"===e?(m.mode=e,a(d),!0):!1},n.setDateFrom=function(e){var t=moment(e,m.format);return t.isValid()?(p.find("span:not(.PAto)").removeClass("PAselected PAfrom"),p.find('span[data-value="'+t.format("YYYYMMDD")+'"]').addClass("PAselected PAfrom"),d=moment(t),o(),!0):!1},n.setDateTo=function(e){var t=moment(e,m.format);return t.isValid()?(p.find("span:not(.PAfrom)").removeClass("PAselected PAto"),p.find('span[data-value="'+t.format("YYYYMMDD")+'"]').addClass("PAselected PAto"),f=moment(t),o(),!0):!1},n.setDate=function(e,t){return n.setDateFrom(e)&&n.setDateTo(t)},n}}(jQuery);