!function($){$.fn.PACalendar=function(e){function t(){for(Y=$("<header></header>").addClass("PAheader"),p=$("<span></span>").html(o.prevArrow).addClass("PAHprev"),c=$("<span></span>").html(o.nextArrow).addClass("PAHnext"),v=$("<span></span>").addClass("PAHmonth"),C=$("<section></section>").addClass("PAweek"),i=1;i<8;i++)C.append($("<span></span>").text(moment().weekday(i).format("dd")));M=$("<section></section>").addClass("PAmonth"),Y.append(p).append(v).append(c),m.addClass("PACalendar").append(Y).append(C).append(M),o.from.element.addClass("date_element").attr("rel",r),o.to.element.addClass("date_element").attr("rel",r)}function a(e){var t=moment(e),a=t.month(),m=t.year();for(v.text(t.format("MMMM YYYY")).attr("data-month",a).attr("data-year",m),t.set("date",1),t.subtract((t.day()||8)-1,"days"),M.find("span").remove(),i=0;i<42;i++){var r=t.date(),s=t.month(),d=t.format("YYYYMMDD"),Y=$("<span></span>").text(r).attr("data-value",d).toggleClass("active",s==a).toggleClass("selected",l==d||f==d);"range"==o.mode&&(Y.toggleClass("from",l==d),Y.toggleClass("to",f==d)),M.append(Y),t.add(1,"days")}n()}function n(){M.find("span").removeClass("between"),"range"==o.mode&&null!=f&&f>l&&M.find(".from").nextUntil("span.to").addClass("between")}var o=$.extend({prevArrow:"&lt;",nextArrow:"&gt;",from:{date:moment().format("YYYY-MM-DD"),element:null},to:{date:null,element:null},mode:"date"},e),m=this,r=Math.random().toString(36).substring(7);null==o.from.date&&o.from.element&&(o.from.date=moment(o.from.element.val())),null==o.to.date&&o.to.element&&(o.to.date=moment(o.to.element.val()));var s=!0,d=moment(o.from.date),l=moment(o.from.date).format("YYYYMMDD"),f="range"==o.mode?moment(o.to.date).format("YYYYMMDD"):null,Y,p,c,v,C,M;return t(),a(d),M.addClass(s?"from":"to"),m.refresh=function(){console.log("refresh")},c.on("click",function(){d.add(1,"months"),a(d)}),p.on("click",function(){d.subtract(1,"months"),a(d)}),M.on("click","span.active",function(){var e=s?"to":"from";M.find("span:not(."+e+")").removeClass("selected"),$(this).addClass("selected");var t=$(this).data("value");s&&(l=t,o.from.element&&o.from.element.val(moment(t,"YYYYMMDD").format("YYYY-MM-DD"))),"range"==o.mode&&(s||(f=t,o.to.element&&o.to.element.val(moment(t,"YYYYMMDD").format("YYYY-MM-DD"))),M.find("span").removeClass(s?"from":"to"),$(this).addClass(s?"from":"to"),l>f?(M.find("span").removeClass("selected between from to"),$(this).addClass("selected from"),l=f,f=null,o.from.element&&o.from.element.val(moment(t,"YYYYMMDD").format("YYYY-MM-DD")),o.to.element&&o.to.element.val(""),s=!1):s=!s),"range"==o.mode&&l&&f&&m.trigger({type:"setDate",from:parseInt(l),to:parseInt(f)}),"range"!=o.mode&&l&&m.trigger({type:"setDate",from:parseInt(l)}),$('.date_element[rel="'+r+'"]').removeClass("active"),o[s?"from":"to"].element.addClass("active"),n()}),m}}(jQuery);