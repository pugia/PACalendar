!function($){$.fn.PACalendar=function(e){function t(){for(c=$("<header></header>").addClass("PAheader"),v=$("<span></span>").html(m.prevArrow).addClass("PAHprev"),p=$("<span></span>").html(m.nextArrow).addClass("PAHnext"),Y=$("<span></span>").addClass("PAHmonth"),u=$("<section></section>").addClass("PAweek"),i=1;i<8;i++)u.append($("<span></span>").text(moment().day(i).format("dd")));C=$("<section></section>").addClass("PAmonth"),c.append(v).append(Y).append(p),n.addClass("PACalendar").append(c).append(u).append(C),m.from.element.addClass("PAcalendar_element").attr("rel",l),m.to.element.addClass("PAcalendar_element").attr("rel",l)}function a(e){var t=moment(e),a=t.month(),n=t.year();for(Y.text(t.format("MMMM YYYY")).attr("data-month",a).attr("data-year",n),t.set("date",1),t.subtract((t.day()||8)-1,"days"),C.find("span").remove(),i=0;i<42;i++){var l=t.date(),s=t.month(),d=moment(t),c=$("<span></span>").text(l).attr("data-value",d.format("YYYYMMDD")).toggleClass("active",s==a);"range"==m.mode&&(c.toggleClass("from",r.isSame(d)),c.toggleClass("to",f.isSame(d))),C.append(c),t.add(1,"days")}o()}function o(){C.find("span").removeClass("selected from to between"),"range"==m.mode&&f.isValid()&&r.isValid()&&r.isBefore(f)&&C.find("span[data-value]").each(function(e,t){var a=moment($(t).attr("data-value"),"YYYYMMDD");$(t).toggleClass("between",a.isAfter(r)&&a.isBefore(f))}),C.find('span[data-value="'+r.format("YYYYMMDD")+'"]').removeClass("between").addClass("selected from"),C.find('span[data-value="'+f.format("YYYYMMDD")+'"]').removeClass("between").addClass("selected to")}var n=this,m=$.extend(!0,{prevArrow:"&laquo;",nextArrow:"&raquo;",from:{date:moment(),element:$('[data-element="from"]')},to:{date:null,element:$('[data-element="to"]')},mode:"date",locale:moment.locale(),format:"YYYY-MM-DD"},e);moment.locale(m.locale);var l=Math.random().toString(36).substring(7);m.from.element&&(m.from.date=moment(m.from.element.val(),m.format),m.from.date.isValid()||(m.from.date=moment()),m.from.element.val(moment(m.from.date).format(m.format))),m.to.element&&(m.to.date=moment(m.to.element.val(),m.format),m.to.date.isValid()||(m.to.date=moment()),m.to.element.val(moment(m.to.date).format(m.format)),m.to.date.isBefore(m.from.date)&&(m.to.element.val(""),m.to.date=null));var s=!0,d=moment(m.from.date),r=moment(m.from.date),f="range"==m.mode?moment(m.to.date):null;m.from.element.addClass("active");var c,v,p,Y,u,C;return t(),a(d),C.addClass(s?"from":"to"),p.off("click").on("click",function(){d.add(1,"months"),a(d)}),v.off("click").on("click",function(){d.subtract(1,"months"),a(d)}),C.off("click","span.active").on("click","span.active",function(){var e=s?"to":"from";console.log(e),C.find("span:not(."+e+")").removeClass("selected"),$(this).addClass("selected");var t=moment($(this).attr("data-value"),"YYYYMMDD");s&&(r=t,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format))),"range"==m.mode&&(s||(f=t,m.to.element&&m.to.element.val(moment(t,"YYYYMMDD").format(m.format))),C.find("span").removeClass(s?"from":"to"),$(this).addClass(s?"from":"to"),r>f?(C.find("span").removeClass("selected between from to"),$(this).addClass("selected from"),r=t,f=null,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format)),m.to.element&&m.to.element.val(""),s=!1):s=!s),"range"==m.mode&&r&&f&&n.trigger({type:"setDate",from:moment(r),to:moment(f)}),"range"!=m.mode&&r&&n.trigger({type:"setDate",from:moment(r)}),$('.PAcalendar_element[rel="'+l+'"]').removeClass("active"),m[s?"from":"to"].element.addClass("active"),o()}),m.from.element&&m.from.element.off("change keyup").on("change keyup",function(){var e=moment($(this).val(),m.format);e.isValid()&&(C.find("span:not(.to)").removeClass("selected from"),C.find('span[data-value="'+e.format("YYYYMMDD")+'"]').addClass("selected from"),r=moment(e),o())}).off("focus").on("focus",function(){s=!0,$('.PAcalendar_element[rel="'+l+'"]').removeClass("active"),m.from.element.addClass("active")}),m.to.element&&m.to.element.off("change keyup").on("change keyup",function(){var e=moment($(this).val(),m.format);e.isValid()&&(C.find("span:not(.from)").removeClass("selected to"),C.find('span[data-value="'+e.format("YYYYMMDD")+'"]').addClass("selected to"),f=moment(e),o())}).off("focus").on("focus",function(){s=!1,$('.PAcalendar_element[rel="'+l+'"]').removeClass("active"),m.to.element.addClass("active")}),n.setMode=function(e){("range"==e||"date"==e)&&(settingsmode=e,a(r))},n}}(jQuery);