!function($){$.fn.PACalendar=function(e){function t(){for(c=$("<header></header>").addClass("PAheader"),v=$("<span></span>").html(m.prevArrow).addClass("PAHprev"),p=$("<span></span>").html(m.nextArrow).addClass("PAHnext"),u=$("<span></span>").addClass("PAHmonth"),Y=$("<section></section>").addClass("PAweek"),i=1;i<8;i++)Y.append($("<span></span>").text(moment().day(i).format("dd")));C=$("<section></section>").addClass("PAmonth"),c.append(v).append(u).append(p),n.addClass("PACalendar").append(c).append(Y).append(C),m.from.element.addClass("PAcalendar_element").attr("rel",s),m.to.element.addClass("PAcalendar_element").attr("rel",s)}function a(e){var t=moment(e),a=t.month(),n=t.year();for(u.text(t.format("MMMM YYYY")).attr("data-month",a).attr("data-year",n),t.set("date",1),t.subtract((t.day()||8)-1,"days"),C.find("span").remove(),i=0;i<42;i++){var s=t.date(),r=t.month(),l=moment(t),c=$("<span></span>").text(s).attr("data-value",l.format("YYYYMMDD")).toggleClass("active",r==a);"range"==m.mode&&(c.toggleClass("from",d.isSame(l)),f&&f.isValid()&&c.toggleClass("to",f.isSame(l))),C.append(c),t.add(1,"days")}o()}function o(){C.find("span").removeClass("selected from to between"),"range"==m.mode&&f&&f.isValid()&&d.isValid()&&d.isBefore(f)&&C.find("span[data-value]").each(function(e,t){var a=moment($(t).attr("data-value"),"YYYYMMDD");$(t).toggleClass("between",a.isAfter(d)&&a.isBefore(f))}),C.find('span[data-value="'+d.format("YYYYMMDD")+'"]').removeClass("between").addClass("selected from"),"range"==m.mode&&f&&f.isValid()&&C.find('span[data-value="'+f.format("YYYYMMDD")+'"]').removeClass("between").addClass("selected to")}var n=this,m=$.extend(!0,{prevArrow:"&laquo;",nextArrow:"&raquo;",from:{date:moment(),element:$('[data-element="from"]')},to:{date:null,element:$('[data-element="to"]')},mode:"date",locale:moment.locale(),format:"YYYY-MM-DD"},e);moment.locale(m.locale);var s=Math.random().toString(36).substring(7);m.from.element&&(m.from.date=moment(m.from.element.val(),m.format),m.from.date.isValid()||(m.from.date=moment()),m.from.element.val(moment(m.from.date).format(m.format))),m.to.element&&(m.to.date=moment(m.to.element.val(),m.format),m.to.date.isValid()||(m.to.date=moment()),m.to.element.val(moment(m.to.date).format(m.format)),m.to.date.isBefore(m.from.date)&&(m.to.element.val(""),m.to.date=null));var r=!0,l=moment(m.from.date),d=moment(m.from.date),f="range"==m.mode?moment(m.to.date):null;m.from.element.addClass("active");var c,v,p,u,Y,C;return t(),a(l),C.addClass(r?"from":"to"),p.off("click").on("click",function(){l.add(1,"months"),a(l)}),v.off("click").on("click",function(){l.subtract(1,"months"),a(l)}),C.off("click","span.active").on("click","span.active",function(){var e=r?"to":"from";C.find("span:not(."+e+")").removeClass("selected"),$(this).addClass("selected");var t=moment($(this).attr("data-value"),"YYYYMMDD");r&&(d=t,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format))),"range"==m.mode&&(r||(f=t,m.to.element&&m.to.element.val(moment(t,"YYYYMMDD").format(m.format))),C.find("span").removeClass(r?"from":"to"),$(this).addClass(r?"from":"to"),d>f?(C.find("span").removeClass("selected between from to"),$(this).addClass("selected from"),d=t,f=null,m.from.element&&m.from.element.val(moment(t,"YYYYMMDD").format(m.format)),m.to.element&&m.to.element.val(""),r=!1):r=!r),"range"==m.mode&&d&&f&&n.trigger({type:"setDate",from:moment(d),to:moment(f)}),"range"!=m.mode&&d&&n.trigger({type:"setDate",from:moment(d)}),$('.PAcalendar_element[rel="'+s+'"]').removeClass("active"),m[r?"from":"to"].element.addClass("active"),o()}),m.from.element&&m.from.element.off("change keyup").on("change keyup",function(){n.setDateFrom($(this).val())}).off("focus").on("focus",function(){r=!0,$('.PAcalendar_element[rel="'+s+'"]').removeClass("active"),m.from.element.addClass("active")}),m.to.element&&m.to.element.off("change keyup").on("change keyup",function(){n.setDateTo($(this).val())}).off("focus").on("focus",function(){r=!1,$('.PAcalendar_element[rel="'+s+'"]').removeClass("active"),m.to.element.addClass("active")}),n.setMode=function(e){return"range"==e||"date"==e?(m.mode=e,a(d),!0):!1},n.setDateFrom=function(e){var t=moment(e,m.format);return t.isValid()?(C.find("span:not(.to)").removeClass("selected from"),C.find('span[data-value="'+t.format("YYYYMMDD")+'"]').addClass("selected from"),d=moment(t),o(),!0):!1},n.setDateTo=function(e){var t=moment(e,m.format);return t.isValid()?(C.find("span:not(.from)").removeClass("selected to"),C.find('span[data-value="'+t.format("YYYYMMDD")+'"]').addClass("selected to"),f=moment(t),o(),!0):!1},n.setDate=function(e,t){return n.setDateFrom(e)&&n.setDateTo(t)},n}}(jQuery);