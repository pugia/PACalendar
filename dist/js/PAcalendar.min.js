!function($){$.fn.PACalendar=function(e){function t(){c=$("<header></header>").addClass("PAheader"),v=$("<span></span>").html(r.prevArrow).addClass("PAHprev"),A=$("<span></span>").html(r.nextArrow).addClass("PAHnext"),P=$("<span></span>").addClass("PAHmonth"),g=$("<section></section>").addClass("PAweek");for(var e=1;8>e;e++)g.append($("<span></span>").text(moment().isoWeekday(e).format("dd")));u=$("<section></section>").addClass("PAmonth"),c.append(v).append(P).append(A),m.addClass("PACalendar").append(c).append(g).append(u),r.from.element.addClass("PAcalendar_element").attr("rel",l),r.to.element.addClass("PAcalendar_element").attr("rel",l)}function a(e){var t=moment(e),a=t.month(),o=t.year();P.text(t.format("MMMM YYYY")).attr("data-month",a).attr("data-year",o),t.set("date",1),t.subtract((t.isoWeekday()||8)-1,"days"),u.find("span").remove();for(var m=0;42>m;m++){var l=t.date(),s=t.month(),d=moment(t),c=!1;c=s===a,r.limit_to&&c&&(c=t.isBefore(r.limit_to)),r.limit_from&&c&&(c=t.isAfter(r.limit_from));var v=$("<span></span>").text(l).attr("data-value",d.format("YYYYMMDD")).toggleClass("PAactive",c);"range"===r.mode&&(v.toggleClass("PAfrom",f.isSame(d)),i&&i.isValid()&&v.toggleClass("PAto",i.isSame(d))),u.append(v),t.add(1,"days")}n()}function n(){u.find("span").removeClass("PAselected PAfrom PAto PAbetween"),"range"===r.mode&&i&&i.isValid()&&f.isValid()&&f.isBefore(i)&&u.find("span[data-value]").each(function(e,t){var a=moment($(t).attr("data-value"),"YYYYMMDD");$(t).toggleClass("PAbetween",a.isAfter(f)&&a.isBefore(i))}),u.find('span[data-value="'+f.format("YYYYMMDD")+'"]').removeClass("PAbetween").addClass("PAselected PAfrom"),"range"===r.mode&&i&&i.isValid()&&u.find('span[data-value="'+i.format("YYYYMMDD")+'"]').removeClass("PAbetween").addClass("PAselected PAto")}function o(e){e="undefined"==typeof e?!1:!0,r.rangeInterval&&2===r.rangeInterval.length&&r.rangeInterval instanceof Array&&"range"===r.mode&&(e?f=moment(i).subtract(r.rangeInterval[0],r.rangeInterval[1]).add(1,"d"):i=moment(f).add(r.rangeInterval[0],r.rangeInterval[1]).subtract(1,"d"),!e&&r.to.element&&r.to.element.val(moment(i).format(r.format)),e&&r.from.element&&r.from.element.val(moment(f).format(r.format)))}var m=this,r=$.extend(!0,{prevArrow:"&laquo;",nextArrow:"&raquo;",from:{date:moment(),element:$('[data-element="from"]')},to:{date:null,element:$('[data-element="to"]')},mode:"date",rangeInterval:null,limit_to:null,limit_from:null,locale:moment.locale(),format:"YYYY-MM-DD"},e);moment.locale(r.locale);var l=Math.random().toString(36).substring(7);r.from.element&&(r.from.date=moment(r.from.element.val(),r.format),r.from.date.isValid()||(r.from.date=moment())),r.to.element&&(r.to.date=moment(r.to.element.val(),r.format),r.to.date.isValid()||(r.to.date=moment()),r.to.element.val(moment(r.to.date).format(r.format)),r.to.date.isBefore(r.from.date)&&(r.to.element.val(""),r.to.date=null));var s=!0,d=moment(r.from.date),f=moment(r.from.date),i="range"===r.mode?moment(r.to.date):null;r.from.element.addClass("PAactive");var c,v,A,P,g,u;return o(),t(),a(d),u.addClass(s?"PAfrom":"PAto"),A.off("click").on("click",function(){d.add(1,"months"),a(d)}),v.off("click").on("click",function(){d.subtract(1,"months"),a(d)}),u.off("click","span.PAactive").on("click","span.PAactive",function(){var e=s?"PAto":"PAfrom";u.find("span:not(."+e+")").removeClass("PAselected"),$(this).addClass("PAselected");var t=moment($(this).attr("data-value"),"YYYYMMDD");s&&(f=t,r.from.element&&r.from.element.val(moment(t,"YYYYMMDD").format(r.format))),"range"===r.mode&&(s||(i=t,r.to.element&&r.to.element.val(moment(t,"YYYYMMDD").format(r.format))),o(),u.find("span").removeClass(s?"PAfrom":"PAto"),$(this).addClass(s?"PAfrom":"PAto"),f>i?(u.find("span").removeClass("PAselected PAbetween PAfrom PAto"),$(this).addClass("PAselected PAfrom"),f=t,r.from.element&&r.from.element.val(moment(t,"YYYYMMDD").format(r.format)),r.to.element&&r.to.element.val(""),s=!1):s=!s,r.rangeInterval&&2===r.rangeInterval.length&&r.rangeInterval instanceof Array&&(s=!0)),"range"===r.mode&&f&&i&&m.trigger({type:"setDate",from:moment(f),to:moment(i)}),"range"!==r.mode&&f&&m.trigger({type:"setDate",from:moment(f)}),$('.PAcalendar_element[rel="'+l+'"]').removeClass("PAactive"),r[s?"from":"to"].element.addClass("PAactive"),n()}),r.from.element&&r.from.element.off("change keyup").on("change keyup",function(){m.setDateFrom($(this).val())}).off("focus").on("focus",function(){s=!0,$('.PAcalendar_element[rel="'+l+'"]').removeClass("PAactive"),r.from.element.addClass("PAactive")}),r.to.element&&r.to.element.off("change keyup").on("change keyup",function(){m.setDateTo($(this).val())}).off("focus").on("focus",function(){s=r.rangeInterval&&2===r.rangeInterval.length&&r.rangeInterval instanceof Array&&"range"===r.mode?!0:!1,$('.PAcalendar_element[rel="'+l+'"]').removeClass("PAactive"),r.to.element.addClass("PAactive")}),m.setMode=function(e){return"range"!==e&&"date"!==e||r.mode===e?!1:(r.mode=e,"date"===r.mode&&(i=null),o(),a(f),!0)},m.setDateFrom=function(e,t){t="boolean"==typeof t?t:!0;var a=moment(e,r.format);return a.isValid()?(u.find("span:not(.PAto)").removeClass("PAselected PAfrom"),u.find('span[data-value="'+a.format("YYYYMMDD")+'"]').addClass("PAselected PAfrom"),f=moment(a),o(),n(),t&&("range"===r.mode&&f&&i&&m.trigger({type:"setDate",from:moment(f),to:moment(i)}),"range"!==r.mode&&f&&m.trigger({type:"setDate",from:moment(f)})),!0):!1},m.setDateTo=function(e,t){t="boolean"==typeof t?t:!0;var a=moment(e,r.format);return a.isValid()?(u.find("span:not(.PAfrom)").removeClass("PAselected PAto"),u.find('span[data-value="'+a.format("YYYYMMDD")+'"]').addClass("PAselected PAto"),i=moment(a),o(!0),n(),t&&"range"===r.mode&&f&&i&&m.trigger({type:"setDate",from:moment(f),to:moment(i)}),!0):!1},m.setRangeInterval=function(e){r.rangeInterval=e,o(),n()},m.setDate=function(e,t){return m.setDateFrom(e)&&m.setDateTo(t)},m}}(jQuery);